<!DOCTYPE html><html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Soul Generator v3 ‚Äî Cipher Tech Reactor Edition</title>
  <meta name="description" content="Tap the core to awaken souls. Cinematic particles, turbine hum, stage ascension, and a sleek Cipher Tech boot sequence." />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-0: #0b0613; /* near-black purple */
      --bg-1: #120a21;
      --purple: #7c3aed;   /* primary purple */
      --purple-soft: #a88cf7;
      --gold: #d4af37;     /* primary gold */
      --gold-soft: #f5d46b;
      --text: #f7f6ff;
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; color: var(--text);
      background: radial-gradient(1200px 1200px at 50% 40%, rgba(124,58,237,0.08), transparent 60%),
                  radial-gradient(900px 900px at 20% 80%, rgba(212,175,55,0.06), transparent 55%),
                  linear-gradient(180deg, var(--bg-1), var(--bg-0));
      font-family: Orbitron, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
      overflow: hidden;
    }/* Top HUD */
header { display:flex; align-items:center; justify-content:center; gap:14px; padding:12px; flex-wrap:wrap; }
.pill { border:1px solid rgba(212,175,55,0.35); background:rgba(124,58,237,0.18); padding:8px 12px; border-radius:999px; font-weight:700; }
.btn { background: linear-gradient(90deg,var(--gold),var(--purple)); border: none; padding: 10px 16px; border-radius: 12px; color: #fff; cursor: pointer; box-shadow: 0 6px 20px rgba(0,0,0,0.4); font-size: 14px; font-weight: 700; }
.btn.outline { background: transparent; border:1px solid var(--gold); color: var(--gold); box-shadow:none; }

/* Arena */
.arena { position: relative; width:100%; height: calc(100vh - 220px); display:grid; place-items:center; }

/* Background pulse wave */
.pulse { position: absolute; inset: 0; pointer-events:none; opacity: 0; transform: scale(0.9); background: radial-gradient(circle at 50% 50%, rgba(212,175,55,0.25), rgba(124,58,237,0.18) 35%, transparent 70%); filter: blur(16px); transition: opacity 500ms ease, transform 600ms ease; }
.pulse.show { opacity: 0.6; transform: scale(1.15); }

/* Orb */
.orb { width:min(42vh, 60vw); height:min(42vh, 60vw); max-width:380px; max-height:380px; border-radius:50%; cursor:pointer; position:relative; isolation:isolate;
  background: radial-gradient(circle at 50% 45%, #fff, var(--gold) 30%, rgba(124,58,237,0.88) 62%, rgba(12,5,22,1) 86%);
  box-shadow: 0 0 60px rgba(124,58,237,0.55), 0 0 120px rgba(212,175,55,0.35), inset 0 0 90px rgba(255,255,255,0.65);
  animation: throb 2.4s ease-in-out infinite; transition: transform 90ms ease, box-shadow 300ms ease; }
.orb::after { content:""; position:absolute; inset:8%; border-radius:50%; pointer-events:none; background: radial-gradient(circle at 40% 30%, rgba(255,255,255,0.95), rgba(245,212,107,0.4) 40%, transparent 70%); filter: blur(2px); mix-blend-mode: screen; }
@keyframes throb { 0%,100%{ transform: scale(1);} 50%{ transform: scale(1.02);} }

/* Tap particles */
.particle { position: fixed; width: 10px; height: 10px; border-radius: 50%; pointer-events:none; mix-blend-mode: screen; opacity: 0.95; filter: blur(0.4px) drop-shadow(0 0 10px rgba(255,255,255,0.45)); }
.particle.gold { background: radial-gradient(circle, var(--gold-soft), var(--gold)); box-shadow: 0 0 18px rgba(245,212,107,0.8); }
.particle.purple { background: radial-gradient(circle, var(--purple-soft), var(--purple)); box-shadow: 0 0 18px rgba(168,140,246,0.8); }

/* Ambient slow embers */
.ember { position: fixed; width: 6px; height: 6px; border-radius: 50%; background: radial-gradient(circle, var(--gold-soft), var(--gold)); mix-blend-mode: screen; opacity: 0.75; filter: drop-shadow(0 0 10px rgba(245,212,107,0.9)); pointer-events:none; animation: ember 12s linear infinite; }
@keyframes ember { 0%{ transform: translate(var(--sx), 110vh) scale(0.6); opacity: 0; } 10%{ opacity: 0.7;} 100%{ transform: translate(calc(var(--sx) + var(--dx)), -20vh) scale(0.5); opacity: 0; } }

/* Ascension message */
.ascend { position: fixed; left: 50%; top: 18%; transform: translate(-50%, -50%); font-size: clamp(18px, 5vw, 36px); font-weight: 700; letter-spacing: 1px; text-align:center; pointer-events:none; opacity:0; transition: opacity 400ms ease; background: linear-gradient(90deg, var(--gold-soft), var(--purple-soft)); -webkit-background-clip: text; background-clip: text; color: transparent; text-shadow: 0 0 30px rgba(212,175,55,0.35), 0 0 40px rgba(124,58,237,0.25); }
.ascend.show { opacity: 1; }

/* Controls */
.controls { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; padding-bottom:10px; }

/* Modal (slide-up shop) */
.modal-bg { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: flex; align-items: flex-end; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
.modal-bg.active {opacity:1; pointer-events: all;}
.shop-modal { width: 100%; max-width: 480px; background: rgba(18,10,33,0.96); border-radius: 20px 20px 0 0; border-top: 2px solid var(--gold); box-shadow: 0 -6px 40px rgba(124,58,237,0.35); transform: translateY(100%); transition: transform 0.35s ease; padding: 18px; }
.modal-bg.active .shop-modal { transform: translateY(0); }
.shop-modal h2 { color: var(--gold); margin: 6px 0 12px; text-align:center; }
.item { display:flex; justify-content:space-between; align-items:center; gap:10px; margin:10px 0; padding:12px; border-radius:12px; background: rgba(124,58,237,0.14); border: 1px solid rgba(212,175,55,0.25); }
.buy { background: linear-gradient(90deg,var(--gold),var(--purple)); border:none; color:#fff; padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:700; }
.sub { font-size:12px; opacity:0.85; }
.close-btn { margin-top: 12px; background: transparent; border: 1px solid var(--gold); color: var(--gold); border-radius: 10px; padding: 8px 14px; cursor: pointer; width:100%; font-weight:700; }
.badge { margin-top:8px; font-size:14px; color:#f5d46b; text-align:center; min-height: 20px; }

/* Boot/Shutdown overlay */
.overlay { position: fixed; inset: 0; background: radial-gradient(1000px 1000px at 50% 50%, rgba(124,58,237,0.12), rgba(0,0,0,0.85)); display:grid; place-items:center; z-index: 20; opacity: 1; transition: opacity 800ms ease; }
.overlay.hidden { opacity: 0; pointer-events:none; }
.boot-text, .off-text { text-align:center; line-height:1.35; }
.boot-line { font-size: clamp(18px, 4.5vw, 32px); font-weight:700; margin: 6px 0; opacity:0; transform: translateY(8px); transition: 600ms ease; background: linear-gradient(90deg, var(--gold-soft), var(--purple-soft)); -webkit-background-clip: text; background-clip: text; color: transparent; text-shadow: 0 0 30px rgba(212,175,55,0.35), 0 0 40px rgba(124,58,237,0.25); }
.boot-line.show { opacity:1; transform: translateY(0); }

/* Watermarks */
.wm-right { position: fixed; right: 10px; bottom: 10px; font-size: 12px; opacity: 0.7; color: var(--gold-soft); text-shadow: 0 0 10px rgba(212,175,55,0.45); }
.wm-left { position: fixed; left: 10px; bottom: 10px; font-size: 11px; opacity: 0.55; color: #cdb7ff; }

  </style>
</head>
<body>
  <header>
    <div class="pill">Souls: <span id="souls">0</span></div>
    <div class="pill">Stage: <span id="stageName">Ember</span></div>
    <button id="soundBtn" class="btn outline">üîá Sound Off</button>
  </header>  <main class="arena">
    <div class="pulse" id="pulse"></div>
    <div class="orb" id="orb" role="button" aria-label="Generate soul energy"></div>
  </main>  <div class="controls">
    <button class="btn" id="openShop">üõçÔ∏è Open Shop</button>
    <button class="btn outline" id="resetBtn" title="Hold to confirm">Reset (hold)</button>
  </div>  <!-- Slide-up Shop Modal -->  <div class="modal-bg" id="shopModal">
    <div class="shop-modal">
      <h2>Upgrades Shop</h2>
      <div class="item"><div><strong>‚ú® Soul Amplifier</strong><div class="sub">+1 per tap</div></div><button class="buy" data-up="tap" data-cost="100">Buy 100üí†</button></div>
      <div class="item"><div><strong>‚ö° Aura Booster</strong><div class="sub">+1 / sec (auto)</div></div><button class="buy" data-up="auto" data-cost="250">Buy 250üí†</button></div>
      <div class="item"><div><strong>üî• Quantum Surge</strong><div class="sub">+10% global boost</div></div><button class="buy" data-up="mult" data-cost="500">Buy 500üí†</button></div>
      <div class="badge" id="msg"></div>
      <button class="close-btn" id="closeShop">Close</button>
    </div>
  </div>  <!-- Boot / Shutdown Overlay -->  <div class="overlay" id="overlay">
    <div class="boot-text" id="bootText">
      <div class="boot-line" id="b1">Cipher Tech</div>
      <div class="boot-line" id="b2">Reactor System</div>
      <div class="boot-line" id="b3">Online</div>
    </div>
    <div class="off-text" id="offText" style="display:none;">
      <div class="boot-line" id="o1">Cipher Tech</div>
      <div class="boot-line" id="o2">Reactor System</div>
      <div class="boot-line" id="o3">Offline</div>
    </div>
  </div>  <!-- Watermarks -->  <div class="wm-right">Powered by Cipher Tech Systems</div>
  <div class="wm-left">v3.0 ‚Äî Cipher Tech Reactor</div>  <div class="ascend" id="ascendMsg"></div>  <script>
  ;(() => {
    // ===== Elements =====
    const orb = document.getElementById('orb');
    const soulsEl = document.getElementById('souls');
    const stageNameEl = document.getElementById('stageName');
    const openShop = document.getElementById('openShop');
    const shopModal = document.getElementById('shopModal');
    const closeShop = document.getElementById('closeShop');
    const resetBtn = document.getElementById('resetBtn');
    const msg = document.getElementById('msg');
    const soundBtn = document.getElementById('soundBtn');
    const overlay = document.getElementById('overlay');
    const bootText = document.getElementById('bootText');
    const offText = document.getElementById('offText');
    const pulse = document.getElementById('pulse');
    const ascendMsg = document.getElementById('ascendMsg');

    // ===== Stages =====
    const STAGES = [
      { name: 'Ember', threshold: 0 },
      { name: 'Lumen', threshold: 100 },
      { name: 'Resonant', threshold: 1000 },
      { name: 'Cipher', threshold: 10000 },
      { name: 'Ascendant', threshold: 100000 }
    ];

    // ===== State =====
    const state = {
      souls: Number(localStorage.getItem('souls')||0),
      perTap: Number(localStorage.getItem('perTap')||1),
      auto: Number(localStorage.getItem('auto')||0),
      mult: Number(localStorage.getItem('mult')||1),
      sound: localStorage.getItem('sound') === 'on' ? 'on' : 'off',
      booted: localStorage.getItem('booted') === 'yes'
    };

    function save(){
      localStorage.setItem('souls', state.souls);
      localStorage.setItem('perTap', state.perTap);
      localStorage.setItem('auto', state.auto);
      localStorage.setItem('mult', state.mult);
      localStorage.setItem('sound', state.sound);
      localStorage.setItem('booted', state.booted ? 'yes' : 'no');
    }

    function format(n){ if(n>=1e9) return (n/1e9).toFixed(2)+'B'; if(n>=1e6) return (n/1e6).toFixed(2)+'M'; if(n>=1e3) return (n/1e3).toFixed(1)+'K'; return Math.floor(n).toString(); }
    function currentStageIndex(total){ let idx=0; for(let i=0;i<STAGES.length;i++){ if(total>=STAGES[i].threshold) idx=i; else break; } return idx; }

    let lastStageIndex = currentStageIndex(state.souls);

    function showAscend(name){
      ascendMsg.textContent = `You have ascended to ${name}.`;
      ascendMsg.classList.add('show');
      setTimeout(()=> ascendMsg.classList.remove('show'), 3000);
    }

    function updateUI(){
      soulsEl.textContent = format(state.souls);
      const idx = currentStageIndex(state.souls);
      const name = STAGES[idx].name;
      stageNameEl.textContent = name;
      if(idx > lastStageIndex){ // stage up
        stageFlare();
        showAscend(name);
        bumpBaseHum(idx);
      }
      lastStageIndex = idx;
      save();
    }

    // ===== Particles & Pulse =====
    function spawnBurst(cx, cy, count=34){
      for(let i=0;i<count;i++){
        const p = document.createElement('div');
        p.className = 'particle ' + (i % 2 ? 'gold' : 'purple');
        p.style.left = cx + 'px';
        p.style.top = cy + 'px';
        const angle = Math.random()*Math.PI*2;
        const dist = 80 + Math.random()*180;
        const dur = 600 + Math.random()*900;
        const tx = cx + Math.cos(angle)*dist;
        const ty = cy + Math.sin(angle)*dist;
        const rot = (Math.random()*40-20);
        p.animate([
          { transform: `translate(-50%,-50%) scale(1) rotate(0deg)`, opacity: 0.98 },
          { transform: `translate(${tx-cx}px, ${ty-cy}px) scale(0.2) rotate(${rot}deg)`, opacity: 0 }
        ], { duration: dur, easing: 'cubic-bezier(.22,.61,.36,1)', fill: 'forwards' });
        document.body.appendChild(p);
        setTimeout(()=> p.remove(), dur+60);
      }
    }

    function pulseWave(){
      pulse.classList.remove('show');
      // force reflow
      void pulse.offsetWidth;
      pulse.classList.add('show');
      setTimeout(()=> pulse.classList.remove('show'), 520);
    }

    // Ambient drifting embers
    function ambientDrift(){
      const ember = document.createElement('div'); ember.className='ember';
      const sx = Math.floor(Math.random()*100); // vw
      const dx = (Math.random()*30-15); // vw drift
      ember.style.setProperty('--sx', sx+'vw');
      ember.style.setProperty('--dx', dx+'vw');
      document.body.appendChild(ember);
      setTimeout(()=> ember.remove(), 12000);
    }
    setInterval(ambientDrift, 1400);

    // ===== Audio (Web Audio API) =====
    let audioCtx=null, masterGain=null, reverb=null, baseHumOsc=null, baseHumGain=null, turbineNoise=null, turbineFilter=null, turbineGain=null;
    let tapBoostTimeout=null; // cooldown for turbine

    function makeImpulseResponse(ctx, seconds=2.2, decay=2.5){
      const rate = ctx.sampleRate; const length = rate * seconds; const impulse = ctx.createBuffer(2, length, rate);
      for (let c=0;c<2;c++){
        const ch = impulse.getChannelData(c);
        for (let i=0;i<length;i++){
          ch[i] = (Math.random()*2-1) * Math.pow(1 - i/length, decay);
        }
      }
      return impulse;
    }

    function ensureAudio(){
      if(state.sound !== 'on') return;
      if(!audioCtx){
        audioCtx = new (window.AudioContext||window.webkitAudioContext)();
        masterGain = audioCtx.createGain(); masterGain.gain.value = 0.45; masterGain.connect(audioCtx.destination);
        // Reverb
        const conv = audioCtx.createConvolver(); conv.buffer = makeImpulseResponse(audioCtx, 2.6, 2.8); reverb = audioCtx.createGain(); reverb.gain.value = 0.18; conv.connect(reverb); reverb.connect(masterGain);

        // Base hum (sine)
        baseHumOsc = audioCtx.createOscillator(); baseHumOsc.type='sine'; baseHumOsc.frequency.value = 70 + currentStageIndex(state.souls)*12; // stage-based
        baseHumGain = audioCtx.createGain(); baseHumGain.gain.value = 0.05; baseHumOsc.connect(baseHumGain); baseHumGain.connect(conv); baseHumGain.connect(masterGain);
        baseHumOsc.start();

        // Turbine layer (filtered noise)
        const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate*2, audioCtx.sampleRate);
        const data = buffer.getChannelData(0); for(let i=0;i<data.length;i++){ data[i] = Math.random()*2-1; }
        turbineNoise = audioCtx.createBufferSource(); turbineNoise.buffer = buffer; turbineNoise.loop = true;
        turbineFilter = audioCtx.createBiquadFilter(); turbineFilter.type='lowpass'; turbineFilter.frequency.value = 800;
        turbineGain = audioCtx.createGain(); turbineGain.gain.value = 0.02; // idle low
        turbineNoise.connect(turbineFilter); turbineFilter.connect(turbineGain); turbineGain.connect(conv); turbineGain.connect(masterGain);
        turbineNoise.start();
      } else if (audioCtx.state === 'suspended') { audioCtx.resume(); }
    }

    function setSound(on){ state.sound = on ? 'on' : 'off'; soundBtn.textContent = on ? 'üîä Sound On' : 'üîá Sound Off'; save(); if(on){ ensureAudio(); } else { if(audioCtx) audioCtx.suspend(); } }

    function bumpBaseHum(idx){ if(baseHumOsc){ baseHumOsc.frequency.setTargetAtTime(70 + idx*12, audioCtx.currentTime, 0.4); } }

    function turbineBoost(){ if(state.sound!=='on' || !audioCtx) return; // raise filter cutoff and gain briefly
      const now = audioCtx.currentTime;
      const targetF = Math.min(2000, turbineFilter.frequency.value + 220); // open up
      const targetG = Math.min(0.35, turbineGain.gain.value + 0.04);
      turbineFilter.frequency.cancelScheduledValues(now);
      turbineGain.gain.cancelScheduledValues(now);
      turbineFilter.frequency.linearRampToValueAtTime(targetF, now+0.08);
      turbineGain.gain.linearRampToValueAtTime(targetG, now+0.08);
      // cooldown after 0.9s without taps
      if(tapBoostTimeout) clearTimeout(tapBoostTimeout);
      tapBoostTimeout = setTimeout(()=>{
        const n = audioCtx.currentTime;
        turbineFilter.frequency.linearRampToValueAtTime(800, n+0.6);
        turbineGain.gain.linearRampToValueAtTime(0.02, n+0.6);
      }, 900);
    }

    // ===== Interactions =====
    function onTap(ev){ ensureAudio(); state.souls += state.perTap*state.mult; updateUI();
      const x = (ev.clientX|| (ev.touches&&ev.touches[0].clientX) || (window.innerWidth/2));
      const y = (ev.clientY|| (ev.touches&&ev.touches[0].clientY) || (window.innerHeight/2));
      spawnBurst(x,y,38); pulseWave(); orb.style.transform='scale(0.985)'; setTimeout(()=> orb.style.transform='scale(1)', 90); turbineBoost(); }

    orb.addEventListener('click', onTap);
    orb.addEventListener('touchstart', (e)=>{ onTap(e.touches[0]); }, {passive:true});

    // Shop
    openShop.onclick = () => { shopModal.classList.add('active'); ensureAudio(); };
    closeShop.onclick = () => shopModal.classList.remove('active');
    shopModal.addEventListener('click', (e)=>{ if(e.target===shopModal) shopModal.classList.remove('active'); });

    // Reset (hold) with shutdown sequence
    let holdTimer=null, holding=false;
    resetBtn.addEventListener('mousedown',()=>{ holding=true; holdTimer=setTimeout(()=>{ if(!holding) return; powerDownAndReset(); }, 1100); });
    ['mouseup','mouseleave','touchend','touchcancel'].forEach(evt => resetBtn.addEventListener(evt,()=>{ holding=false; clearTimeout(holdTimer); }));

    function powerDownAndReset(){
      // Show OFF overlay
      offText.style.display='block'; bootText.style.display='none'; overlay.classList.remove('hidden');
      // animate OFF lines
      ['o1','o2','o3'].forEach((id,i)=>{ setTimeout(()=> document.getElementById(id).classList.add('show'), 120*i); });
      // lower audio
      if(audioCtx){ const now = audioCtx.currentTime; if(baseHumGain) baseHumGain.gain.linearRampToValueAtTime(0.0001, now+0.6); if(turbineGain) turbineGain.gain.linearRampToValueAtTime(0.0001, now+0.6); }
      setTimeout(()=>{
        state.souls=0; state.perTap=1; state.auto=0; state.mult=1; save(); updateUI();
        // hide overlay again
        setTimeout(()=>{ overlay.classList.add('hidden'); offText.style.display='none'; bootText.style.display='block'; ['o1','o2','o3'].forEach(id=> document.getElementById(id).classList.remove('show')); if(baseHumGain){ baseHumGain.gain.value=0.05; } if(turbineGain){ turbineGain.gain.value=0.02; } }, 700);
      }, 1200);
    }

    // Buy buttons
    document.querySelectorAll('.buy').forEach(b=>{
      b.onclick = () => {
        const cost = Number(b.dataset.cost); const up = b.dataset.up;
        if(state.souls < cost){ msg.textContent='Not enough souls'; return; }
        state.souls -= cost;
        if(up==='tap') { state.perTap += 1; msg.textContent='Soul Amplifier acquired!'; }
        if(up==='auto'){ state.auto += 1; msg.textContent='Aura Booster active!'; }
        if(up==='mult'){ state.mult = +(state.mult + 0.1).toFixed(2); msg.textContent='Quantum Surge!'; }
        updateUI(); turbineBoost();
      };
    });

    // Auto generation
    setInterval(()=>{ if(state.auto>0){ state.souls += state.auto*state.mult; updateUI(); } }, 1000);

    // Sound control
    soundBtn.onclick = () => setSound(state.sound !== 'on');

    // Initial paint
    updateUI();
    setSound(state.sound === 'on');

    // Boot sequence (once only)
    function runBoot(){
      if(state.booted){ overlay.classList.add('hidden'); return; }
      const seq = ['b1','b2','b3'];
      seq.forEach((id,i)=> setTimeout(()=> document.getElementById(id).classList.add('show'), 320*i));
      setTimeout(()=>{ overlay.classList.add('hidden'); state.booted = true; save(); }, 1600);
    }
    runBoot();
  })();
  </script></body>
</html>
