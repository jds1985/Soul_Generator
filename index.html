<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Soul Generator v3.4 ‚Äî Soul Reactor (Stabilized)</title>
  <meta name="description" content="Tap the core to awaken souls. Rainbow XP bar, cinematic particles, wind-chime ambience, sparkling taps, stage-evolving orb, and Soul Reactor upgrades." />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg-0:#0b0613;
      --bg-1:#120a21;
      --purple:#7c3aed;
      --purple-soft:#a88cf7;
      --gold:#d4af37;
      --gold-soft:#f5d46b;
      --text:#f7f6ff;
      --orb-inner:#ffffff;
      --orb-mid:#d4af37;
      --orb-outer:rgba(124,58,237,0.90);
      --pulse-gold:rgba(212,175,55,0.30);
      --pulse-purple:rgba(124,58,237,0.24);
    }

    *{box-sizing:border-box;}
    html,body{
      height:100%;
      margin:0;
      font-family:Orbitron,sans-serif;
      color:var(--text);
      background:radial-gradient(1200px 1200px at 50% 40%,rgba(124,58,237,0.10),transparent 60%),
                 radial-gradient(900px 900px at 20% 80%,rgba(212,175,55,0.08),transparent 55%),
                 linear-gradient(180deg,var(--bg-1),var(--bg-0));
      overflow-y:auto;
      padding-bottom:calc(env(safe-area-inset-bottom) + 20px);
    }

    header{display:flex;align-items:center;justify-content:center;gap:14px;padding:12px;flex-wrap:wrap;}
    .pill{border:1px solid rgba(212,175,55,0.35);background:rgba(124,58,237,0.18);padding:8px 12px;border-radius:999px;font-weight:700;}
    .btn{background:linear-gradient(90deg,var(--gold),var(--purple));border:none;padding:10px 16px;border-radius:12px;color:#fff;cursor:pointer;box-shadow:0 6px 20px rgba(0,0,0,0.4);font-size:14px;font-weight:700;}
    .btn.outline{background:transparent;border:1px solid var(--gold);color:var(--gold);box-shadow:none;}

    .xp-wrap{width:min(92vw,980px);margin:6px auto 0;padding:0 8px;}
    .xp{position:relative;height:30px;border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,0.15);
        background:rgba(20,12,36,0.55);box-shadow:0 0 20px rgba(124,58,237,0.25) inset,0 0 16px rgba(212,175,55,0.18);
        animation:pulseSync 2.4s ease-in-out infinite;}
    .xp::before{content:"";position:absolute;inset:0;background:linear-gradient(90deg,#ff0080,#ff8c00,#ffe600,#21d07a,#00b3ff,#7c3aed,#ff0080);
        background-size:400% 100%;filter:blur(6px);opacity:0.65;animation:rainbow 10s linear infinite;}
    .xp-fill{position:absolute;top:0;left:0;height:100%;width:0%;border-radius:999px;background:linear-gradient(90deg,rgba(212,175,55,0.9),rgba(124,58,237,0.95));
        box-shadow:0 0 18px rgba(212,175,55,0.45),0 0 24px rgba(124,58,237,0.35);transition:width 420ms ease;}
    .xp-text{position:absolute;inset:0;display:grid;place-items:center;font-size:12px;letter-spacing:0.5px;text-shadow:0 0 8px rgba(255,255,255,0.5);}
    @keyframes rainbow{0%{background-position:0% 50%;}100%{background-position:400% 50%;}}
    @keyframes pulseSync{0%,100%{box-shadow:0 0 20px rgba(124,58,237,0.25) inset,0 0 16px rgba(212,175,55,0.18);}50%{box-shadow:0 0 30px rgba(124,58,237,0.35) inset,0 0 28px rgba(212,175,55,0.28);}}

    .arena{position:relative;width:100%;height:calc(100vh - 254px);display:grid;place-items:center;}
    .pulse{position:absolute;inset:0;pointer-events:none;opacity:0;transform:scale(0.9);
        background:radial-gradient(circle at 50% 50%,var(--pulse-gold),var(--pulse-purple) 35%,transparent 72%);
        filter:blur(22px);transition:opacity 650ms ease,transform 900ms ease;}
    .pulse.show{opacity:0.85;transform:scale(1.25);}
    .orb{width:min(42vh,60vw);height:min(42vh,60vw);max-width:380px;max-height:380px;border-radius:50%;cursor:pointer;position:relative;isolation:isolate;
        background:radial-gradient(circle at 50% 45%,var(--orb-inner),var(--orb-mid) 30%,var(--orb-outer) 62%,rgba(12,5,22,1) 86%);
        box-shadow:0 0 60px rgba(124,58,237,0.6),0 0 140px rgba(212,175,55,0.45),inset 0 0 90px rgba(255,255,255,0.65);
        animation:throb 2.4s ease-in-out infinite;}
    @keyframes throb{0%,100%{transform:scale(1);}50%{transform:scale(1.02);}}

    .controls{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;padding-bottom:calc(env(safe-area-inset-bottom)+12px);}

    .modal-bg{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:flex-end;justify-content:center;opacity:0;pointer-events:none;transition:opacity 0.3s ease;}
    .modal-bg.active{opacity:1;pointer-events:all;}
    .shop-modal{width:100%;max-width:480px;background:rgba(18,10,33,0.96);border-radius:20px 20px 0 0;border-top:2px solid var(--gold);
        box-shadow:0 -6px 40px rgba(124,58,237,0.35);transform:translateY(100%);transition:transform 0.35s ease;padding:18px;}
    .modal-bg.active .shop-modal{transform:translateY(0);}
    .item{display:flex;justify-content:space-between;align-items:center;gap:10px;margin:10px 0;padding:12px;border-radius:12px;background:rgba(124,58,237,0.14);border:1px solid rgba(212,175,55,0.25);}
    .buy{background:linear-gradient(90deg,var(--gold),var(--purple));border:none;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700;}
    .close-btn{margin-top:12px;background:transparent;border:1px solid var(--gold);color:var(--gold);border-radius:10px;padding:8px 14px;cursor:pointer;width:100%;font-weight:700;}

    .overlay{position:fixed;inset:0;background:radial-gradient(1000px 1000px at 50% 50%,rgba(124,58,237,0.12),rgba(0,0,0,0.85));display:grid;place-items:center;z-index:20;opacity:1;transition:opacity 800ms ease;}
    .overlay.hidden{opacity:0;pointer-events:none;}
    .boot-line{font-size:clamp(18px,4.5vw,32px);font-weight:700;margin:6px 0;opacity:0;transform:translateY(8px);transition:600ms ease;
        background:linear-gradient(90deg,var(--gold-soft),var(--purple-soft));-webkit-background-clip:text;background-clip:text;color:transparent;
        text-shadow:0 0 30px rgba(212,175,55,0.35),0 0 40px rgba(124,58,237,0.25);}
    .boot-line.show{opacity:1;transform:translateY(0);}
    .wm-right{position:fixed;right:10px;bottom:10px;font-size:12px;opacity:0.7;color:var(--gold-soft);}
    .wm-left{position:fixed;left:10px;bottom:10px;font-size:11px;opacity:0.55;color:#cdb7ff;}
  </style>
</head>

<body>
<header>
  <div class="pill">Souls: <span id="souls">0</span></div>
  <div class="pill">Stage: <span id="stageName">Ember</span></div>
  <button id="soundBtn" class="btn outline">üîá Sound Off</button>
</header>

<div class="xp-wrap">
  <div class="xp">
    <div class="xp-fill" id="xpFill"></div>
    <div class="xp-text" id="xpText">XP: 0 / 100</div>
  </div>
</div>

<main class="arena">
  <div class="pulse" id="pulse"></div>
  <div class="orb" id="orb" role="button" aria-label="Generate soul energy"></div>
</main>

<div class="controls">
  <button class="btn" id="openShop">üõçÔ∏è Open Shop</button>
  <button class="btn outline" id="resetBtn">Reset (hold)</button>
</div>

<div class="modal-bg" id="shopModal">
  <div class="shop-modal">
    <h2>Reactor Upgrades</h2>
    <div class="item"><div><strong>‚ú® Soul Amplifier</strong><div class="sub">+1 per tap</div></div><button class="buy" data-up="tap" data-cost="100">Buy 100üí†</button></div>
    <div class="item"><div><strong>‚ö° Aura Booster</strong><div class="sub">+1 / sec (auto)</div></div><button class="buy" data-up="auto" data-cost="250">Buy 250üí†</button></div>
    <div class="item"><div><strong>üî• Quantum Surge</strong><div class="sub">+10% global boost</div></div><button class="buy" data-up="mult" data-cost="500">Buy 500üí†</button></div>
    <button class="close-btn" id="closeShop">Close</button>
  </div>
</div>

<div class="overlay" id="overlay">
  <div>
    <div class="boot-line" id="b1">Soul Reactor</div>
    <div class="boot-line" id="b2">System Online</div>
  </div>
</div>

<div class="wm-right">Powered by DigiSoul</div>
<div class="wm-left">v3.4 ‚Äî Soul Reactor</div>

<script>
(() => {
  const orb=document.getElementById('orb'),soulsEl=document.getElementById('souls'),
        stageNameEl=document.getElementById('stageName'),openShop=document.getElementById('openShop'),
        shopModal=document.getElementById('shopModal'),closeShop=document.getElementById('closeShop'),
        resetBtn=document.getElementById('resetBtn'),soundBtn=document.getElementById('soundBtn'),
        overlay=document.getElementById('overlay'),pulse=document.getElementById('pulse'),
        xpFill=document.getElementById('xpFill'),xpText=document.getElementById('xpText');

  const STAGES=[
    {name:'Ember',threshold:0,colors:{inner:'#fff6e0',mid:'#e1c25b',outer:'rgba(124,58,237,0.85)'}},
    {name:'Lumen',threshold:100,colors:{inner:'#ffffff',mid:'#f1db87',outer:'rgba(168,120,255,0.90)'}},
    {name:'Resonant',threshold:1000,colors:{inner:'#dcd1ff',mid:'#c89bff',outer:'rgba(120,70,245,0.95)'}},
    {name:'Cipher',threshold:10000,colors:{inner:'#efe9ff',mid:'#e4c04f',outer:'rgba(135,60,255,0.98)'}},
    {name:'Ascendant',threshold:100000,colors:{inner:'#ffffff',mid:'#fff3b0',outer:'rgba(255,255,255,0.9)'}}
  ];
  function applyColors(c){document.documentElement.style.setProperty('--orb-inner',c.inner);
    document.documentElement.style.setProperty('--orb-mid',c.mid);
    document.documentElement.style.setProperty('--orb-outer',c.outer);}

  const state={souls:0,perTap:1,auto:0,mult:1,sound:'off'};
  let audioCtx=null,masterGain=null,reverb=null,unlocked=false;
  document.addEventListener('pointerdown',()=>{if(!unlocked){audioCtx=new (window.AudioContext||window.webkitAudioContext)();audioCtx.resume();unlocked=true;}},{once:true});

  function makeImpulseResponse(ctx){const rate=ctx.sampleRate,len=rate*2.5,imp=ctx.createBuffer(2,len,rate);
    for(let c=0;c<2;c++){const ch=imp.getChannelData(c);for(let i=0;i<len;i++)ch[i]=(Math.random()*2-1)*Math.pow(1-i/len,2.5);}return imp;}
  function ensureAudio(){
    if(state.sound!=='on')return;
    if(!audioCtx){audioCtx=new (window.AudioContext||window.webkitAudioContext)();
      masterGain=audioCtx.createGain();masterGain.gain.value=0.5;masterGain.connect(audioCtx.destination);
      const conv=audioCtx.createConvolver();conv.buffer=makeImpulseResponse(audioCtx);
      reverb=audioCtx.createGain();reverb.gain.value=0.25;conv.connect(reverb);reverb.connect(masterGain);}
    else if(audioCtx.state==='suspended')audioCtx.resume();
  }
  function playClick(){if(state.sound!=='on'||!audioCtx)return;const o=audioCtx.createOscillator(),g=audioCtx.createGain();
    o.type='triangle';o.frequency.value=900+Math.random()*300;g.gain.value=0.001;
    o.connect(g);g.connect(reverb);g.connect(masterGain);const now=audioCtx.currentTime;
    g.gain.exponentialRampToValueAtTime(0.15,now+0.01);g.gain.exponentialRampToValueAtTime(0.0001,now+0.25);
    o.start();o.stop(now+0.26);}
  soundBtn.onclick=()=>{state.sound=state.sound==='on'?'off':'on';soundBtn.textContent=state.sound==='on'?'üîä Sound On':'üîá Sound Off';ensureAudio();};

  function format(n){return n>=1e3?(n/1e3).toFixed(1)+'K':Math.floor(n);}
  function updateUI(){
    soulsEl.textContent=format(state.souls);
    const idx=STAGES.findIndex((s,i)=>state.souls<STAGES[i+1]?.threshold)||STAGES.length-1;
    const s=STAGES[idx];applyColors(s.colors);stageNameEl.textContent=s.name;
    const next=STAGES[idx+1];if(next){const prog=(state.souls-s.threshold)/(next.threshold-s.threshold);
      xpFill.style.width=(prog*100)+'%';xpText.textContent=`XP: ${format(state.souls)} / ${format(next.threshold)}`;}
    else{xpFill.style.width='100%';xpText.textContent='XP: MAX';}
  }

  orb.addEventListener('click',e=>{
    ensureAudio();state.souls+=state.perTap*state.mult;updateUI();pulse.classList.add('show');
    setTimeout(()=>pulse.classList.remove('show'),600);playClick();
  });

  openShop.onclick=()=>shopModal.classList.add('active');
  closeShop.onclick=()=>shopModal.classList.remove('active');

  document.querySelectorAll('.buy').forEach(btn=>{
    btn.onclick=()=>{const cost=+btn.dataset.cost,up=btn.dataset.up;
      if(state.souls<cost)return;
      state.souls-=cost;
      if(up==='tap')state.perTap++;
      if(up==='auto')state.auto++;
      if(up==='mult')state.mult+=0.1;
      updateUI();
    };
  });

  setInterval(()=>{if(state.auto>0){state.souls+=state.auto*state.mult;updateUI();}},1000);
  resetBtn.onclick=()=>{state.souls=0;state.perTap=1;state.auto=0;state.mult=1;updateUI();};
  updateUI();
  setTimeout(()=>{overlay.classList.add('hidden');},1500);
})();
</script>
</body>
</html>
